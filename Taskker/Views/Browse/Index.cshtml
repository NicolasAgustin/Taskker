@using Taskker.Models
@using Taskker.Models.DAL
@* cambiar modelo por Grupo *@
@model Grupo
@*List<Tarea>*@
@{
    var session = Session["UserSession"] as UserSession;
    var email = session.Email;
    var picture = session.EncodedPicture;
    var nombre = session.NombreApellido;
    var gruposNombres = (List<string>)Session["Grupos"];
}

@section scripts{
    @Scripts.Render("~/Scripts/jquery-3.4.1.min.js")
    @Scripts.Render("~/Scripts/download_report.js")
}

<style>
    tr {
        background-color: rgba(0, 0, 0, 0.45);
        border-radius: 5px;
    }
</style>

<script>
    // Inicializamos el sidenav
    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('.sidenav');
        var instances = M.Sidenav.init(
            elems,
            {
                edge: 'left',
            });
    });

    // Inicializamos el modal
    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('#details');
        var instances = M.Modal.init(
            elems,
            {
                preventScrolling: true
            }
        );
    });

</script>

<script>
    $(document).ready(function () {

        $('#details').modal({
            onOpenStart: function (modal, trigger) {
                console.log('Se abre el modal details')

                $.ajax({
                    url: "/Browse/TaskDetails",
                    type: 'GET',
                    data: { titulo: trigger.children[0].textContent },
                    success: function (data) {
                        $("#details").html(data);
                    }
                });
            },

            onCloseStart: function (modal, trigger) {
                console.log('Se cierra el modal')
                document.getElementById('update-form').submit()
            }
        });
    })
</script>

<script>
    $(document).ready(function () {
        $('#create').modal({
            onOpenStart: function (modal, trigger) {
                console.log('Se abre el modal create')
                $.ajax({
                    type: 'GET',
                    url: "/Browse/CreateTask",
                    success: function (data) {
                        $("#create").html(data);
                    }
                });
            },
            onOpenEnd: function (modal, trigger) {
                console.log('Termino de abrirse el modal create')
            }
        })
    })

    $(document).ready(function () {
        $('#add-task').on('click', function () {
            M.Modal.getInstance($("#create")).open()
        });
    });

</script>

<nav>
    <div class="nav-wrapper">
        <a href="#" class="brand-logo">Taskker</a>
    </div>
</nav>

<ul id="slide-out" class="sidenav">
    <li>
        <div class="user-view">
            <div class="background">
                <img src="@Url.Content("~/images/fondo-rosa.jpg")">
            </div>
            <a href="#user"><img class="circle" src="@picture"></a>
            <a href="#name"><span class="white-text name">@nombre</span></a>
            <a href="#email"><span class="white-text email">@email</span></a>
            <a href="@Url.Action("Logout", "Auth")">Salir</a> | <a href="#">Perfil</a>
        </div>
    </li>
    <li><a href="@Url.Action("Create", "Groups")"><i class="material-icons">group</i>Crear grupo</a></li>
    <li><a href="@Url.Action("Join", "Groups")"><i class="material-icons">group_add</i>Unirse</a></li>
    <li><div class="divider"></div></li>
    <li><a class="subheader">Grupos</a></li>
    @{
        foreach (var grupo in gruposNombres)
        {
            <li><a class="waves-effect" href="@Url.Action("Index", "Browse", new { grupo = grupo })">@grupo</a></li>
        }
    }

</ul>

<div class="row">
    <a href="#" data-target="slide-out" class="sidenav-trigger">
        <i class="small material-icons">menu</i>
    </a>
</div>

<div class="row">
    <h2>@Model.Nombre</h2>
</div>


@if (((List<string>)ViewData["Roles"]).Contains("Project Manager"))
{
    <div class="row">
        <a class="waves-effect waves-light btn modal-trigger" data-target="create" id="add-task">
            <i class="small material-icons left">add</i>Crear tarea
        </a>
    </div>
}

<div class="row">
    <a class="waves-effect waves-light btn" id="download-report" href="@Url.Action("DownloadReport", "Report")">
        <i class="small material-icons left">add</i>Descargar reporte de horas
    </a>
</div>

<!-- Modal Trigger -->
<div id="details" class="modal">
</div>

<div id="create" class="modal">
</div>

<div class="row">
    <table class="highlight">
        <thead>
            <tr>
                <th>Titulo</th>
            </tr>
        </thead>

        <tbody>
            @{
                foreach (var tarea in Model.Tareas)
                {
                    <tr data-target="details" class="modal-trigger">
                        <td>@tarea.Titulo</td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
